{% extends "base.html" %}

{% block title %}알림: 탐지 실패 로그{% endblock %}

{% block page_title %}
<div style="font-size:28px; font-weight:800; text-align:center; margin: 8px 0 10px 0;">알림: 탐지 실패 로그</div>
{% endblock %}

{% block content %}
<style>
    /* 이 페이지에 필요한 스타일 (details.html과 유사) */
    .card{ background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)) padding-box, linear-gradient(180deg, rgba(59,130,246,.25), rgba(20,184,166,.18)) border-box; border:1px solid transparent; border-radius:16px; box-shadow: 0 10px 40px rgba(0,0,0,.25); overflow:hidden; }
    .filters{display:grid;grid-template-columns:repeat(12,1fr);gap:12px; padding:16px}
    .field{grid-column:span 4;display:flex;flex-direction:column;gap:6px}
    .field label{font-size:12px;color:var(--muted)}
    .field input{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#0b1220;font-size:14px;color:var(--text)}
    .toolbar{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-top:1px solid var(--border)}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#0b1220;font-weight:700;cursor:pointer;color:var(--text)}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .table-wrap{overflow:auto}
    table{width:100%;border-collapse:collapse}
    thead th{position:sticky;top:0;background:#0b1220;border-bottom:1px solid var(--border);font-size:12px;color:var(--muted);text-align:left;padding:10px}
    tbody td{border-bottom:1px solid var(--border);padding:12px;font-size:14px;vertical-align:top;color:var(--text)}
    .empty{padding:28px;text-align:center;color:var(--muted)}
</style>

<section class="card" aria-label="필터">
    <div class="filters">
        <div class="field"><label for="from">시작 일자</label><input type="date" id="from" /></div>
        <div class="field"><label for="to">종료 일자</label><input type="date" id="to" /></div>
        <div class="field"><label for="emp">사용자(사번)</label><input id="emp" placeholder="예: A1023" /></div>
        <div class="field col-span-full md:col-span-8"><label for="q">검색(파일명/실패사유)</label><input id="q" placeholder="예: secret.pdf, 암호화..." /></div>
    </div>
    <div class="toolbar">
        <div class="muted" id="summary">총 {{ logs|length }}건</div>
        <div class="actions">
            <button class="btn" id="resetBtn">초기화</button>
            <button class="btn primary" id="applyBtn">적용</button>
        </div>
    </div>
</section>

<section class="card mt-4" aria-label="목록">
    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th style="width:150px">일시</th><th style="width:110px">사용자</th>
                    <th style="width:140px">소스 유형</th><th>파일명</th><th>실패 사유</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ log.employee_id }}</td>
                    <td>{{ log.file_type.type_name }}</td>
                    <td>{{ log.filename or '-' }}</td>
                    <td>{{ log.reason or '' }}</td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="empty">조건에 맞는 실패 로그가 없습니다.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    function applyFilters() {
        const params = new URLSearchParams();
        const from = document.getElementById('from').value, to = document.getElementById('to').value;
        const emp = document.getElementById('emp').value, q = document.getElementById('q').value;
        if (from) params.set('from', from); if (to) params.set('to', to);
        if (emp) params.set('emp', emp); if (q) params.set('q', q);
        window.location.href = `/alerts?${params.toString()}`;
    }

    function populateFilters() {
        const params = new URLSearchParams(window.location.search);
        document.getElementById('from').value = params.get('from') || '';
        document.getElementById('to').value = params.get('to') || '';
        document.getElementById('emp').value = params.get('emp') || '';
        document.getElementById('q').value = params.get('q') || '';
    }

    document.getElementById('applyBtn').addEventListener('click', applyFilters);
    document.getElementById('resetBtn').addEventListener('click', () => { window.location.href = '/alerts'; });
    document.addEventListener('DOMContentLoaded', populateFilters);
</script>
{% endblock %}